version: '2.0'

services:
    redis:
        image: redis:3.2
        networks:
            bibapinet:
                aliases:
                    - redis
    postgres-dev:
        image: postgres:9.5
        environment:
            POSTGRES_USER: postgres
            POSTGRES_PASSWORD: secret
            POSTGRES_DB: bibapi-dev
            PGDATA: /var/lib/postgresql/data/pgdata
        volumes:
            - ./backups:/backups
            - /applis/bibapi/home/postgresql-dev:/var/lib/postgresql/data/pgdata
        ports:
            - 5432:5432
        networks:
            bibapinet:
                aliases:
                    - postgres-dev
    adminer:
        image: adminer
        ports:
            - 8081:8080
        networks:
            bibapinet:
                aliases:
                    - adminer

    server:
        extends:
            file: ./docker-compose.yml
            service: node
        environment:
            NODE_ENV: development
            http_proxy: ${http_proxy}
            https_proxy: ${https_proxy}
            POSTGRES_USER: postgres
            POSTGRES_PASSWORD: secret
            POSTGRES_DB: bibapi-dev
            POSTGRES_HOST: postgres-dev
            MAIL_SERVER_HOST: bibapi_smtphost_maildev
            MAIL_SERVER_PORT: 25
        ports:
            - 3000:3000
        command: npm run dev
        networks:
            bibapinet:
                aliases:
                    - server

    maildev:
        image: djfarrelly/maildev
        container_name: bibapi_smtphost_maildev
        ports:
            - 1080:80
        networks:
            bibapinet:
                aliases:
                    - maildev

networks:
    bibapinet:
        driver: "bridge"
